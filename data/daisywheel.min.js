!function(e,t){"function"==typeof define&&define.amd?define(["underscore"],t):"object"==typeof exports?module.exports=t(require("underscore")):e.returnExports=t(e._)}(this,function(e){e||console.error("Underscore.js is not defined. Remember to include it before importing DaisywheelJS");var t={setCursor:function(e,t){var e="string"==typeof e||e instanceof String?document.getElementById(e):e;if(!e)return!1;if(e.createTextRange){t+="";var n=e.createTextRange();return n.collapse(!0),n.moveEnd(t),n.moveStart(t),n.select(),!0}return e.setSelectionRange?(e.setSelectionRange(t,t),!0):!1},getCursor:function(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null==t)return 0;var n=e.createTextRange(),s=n.duplicate();return n.moveToBookmark(t.getBookmark()),s.setEndPoint("EndToStart",n),s.text.length}return 0}};!function(e,t){function n(e){var n=t[e];t[e]=function(e){return i(n(e))}}function s(t,n,s){return(s=this).attachEvent("on"+t,function(t){var t=t||e.event;t.preventDefault=t.preventDefault||function(){t.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){t.cancelBubble=!0},n.call(s,t)})}function i(e,t){if(t=e.length)for(;t--;)e[t].addEventListener=s;else e.addEventListener=s;return e}e.addEventListener||(i([t,e]),"Element"in e?e.Element.prototype.addEventListener=s:(t.attachEvent("onreadystatechange",function(){i(t.all)}),n("getElementsByTagName"),n("getElementById"),n("createElement"),i(t.all)))}(window,document),function(){function e(e){this.el=e;for(var t=e.className.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<t.length;n++)s.call(this,t[n])}function t(e,t,n){Object.defineProperty?Object.defineProperty(e,t,{get:n}):e.__defineGetter__(t,n)}if(!("undefined"==typeof window.Element||"classList"in document.documentElement)){var n=Array.prototype,s=n.push,i=n.splice,o=n.join;e.prototype={add:function(e){this.contains(e)||(s.call(this,e),this.el.className=this.toString())},contains:function(e){return-1!=this.el.className.indexOf(e)},item:function(e){return this[e]||null},remove:function(e){if(this.contains(e)){for(var t=0;t<this.length&&this[t]!=e;t++);i.call(this,t,1),this.el.className=this.toString()}},toString:function(){return o.call(this," ")},toggle:function(e){return this.contains(e)?this.remove(e):this.add(e),this.contains(e)}},window.DOMTokenList=e,t(Element.prototype,"classList",function(){return new e(this)})}}();var n={symbolSets:["abcdefghijklmnopqrstuvwxyz?!;\\&-".split(""),"ABCDEFGHIJKLMNOPQRSTUVWXYZ+.@#$%".split(""),"0123456789*,_=\"'()[]{}:~^<>|".split("")],symbolSetNumber:0,petals:[],buttons:[],currentPetalNum:0,buttonMapping:{0:3,1:2,2:0,3:1},lastButtonDownId:0,lastButtonIsUp:!0,numOfPetals:8,uiElements:["left-bumper","left-analog","right-bumper","left-trigger","right-trigger"],uiLabels:{"left-bumper":"Backspace","left-analog":"Select Petal","right-bumper":"Space","left-trigger":"Numbers","right-trigger":"Caps"},gamepadConnected:!1,init:function(){this.setupElements(),this.setupStyles(),this.setupFontStyles(),this.attachSymbols(),document.addEventListener("focus",e.bind(this.onFocusEvent,this),!0),window.addEventListener("ongamepadupdate",e.bind(this.onGamepadEvent,this)),window.addEventListener("resize",e.throttle(e.bind(this.setupSize,this),100)),window.addEventListener("keyup",e.bind(function(e){27===e.which&&this.loaded&&(this.unload(),this.inputEl&&this.inputEl.blur())},this))},setupElements:function(){var e=document.createElement("div");e.id="daisywheel-js",document.body.appendChild(e),this.setupModal(),this.setupFlower(),this.setupControlsUI(),this.setupSize()},setupModal:function(){var e=document.getElementById("daisywheel-js"),t=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),a=document.createElement("div"),l=document.createElement("input");i.id="daisywheel",t.id="daisywheel-modal-overlay",n.id="daisywheel-modal-container",s.id="daisywheel-modal",o.id="daisywheel-controller-warning",o.innerHTML=window.gamepadSupportAvailable?'Connect a gamepad controller to use the <a href="http://daisywheeljs.org">Daisywheel</a>':'This browser does not support the Gamepad API. Check <a href="http://caniuse.com/#feat=gamepad">this list</a> for support',a.id="daisywheel-input-container",l.id="daisywheel-input",a.appendChild(l),i.appendChild(a),s.appendChild(o),s.appendChild(i),n.appendChild(s),t.appendChild(n),e.appendChild(t)},setupFlower:function(){for(var e=document.getElementById("daisywheel"),t=document.createElement("div"),n=document.createDocumentFragment(),s=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),a=["left","top","right","bottom"],l=0;l<a.length;l++){var r=document.createElement("div");r.className="button button-"+a[l],o.appendChild(r)}o.className="buttons",i.className="petal-inner",s.className="petal",i.appendChild(o),s.appendChild(i),n.appendChild(s);for(var d=0;d<this.numOfPetals;d++)s=n.cloneNode(!0),t.appendChild(s);this.petals=document.getElementsByClassName("petal"),t.id="daisywheel-flower",e.appendChild(t)},setupControlsUI:function(){var e=document.getElementById("daisywheel"),t=document.getElementById("daisywheel-controls-ui");t?t.innerHTML="":(t=document.createElement("div"),t.id="daisywheel-controls-ui",e.appendChild(t));for(var n=0;n<this.uiElements.length;n++){var s=document.createElement("div"),i=this.uiElements[n],o=document.createElement("div"),a=document.createElement("div"),l=this.uiLabels[i];s.id="daisywheel-"+i+"-ui",s.className="control-ui cf",o.className="control-ui-icon",a.className="control-ui-label",a.textContent=l,a.title=l,s.appendChild(o),s.appendChild(a),t.appendChild(s)}},setupSize:function(){var e=document.getElementById("daisywheel-modal"),t=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,n=25,s=100,i=1e3,o=Math.floor(s*(t/(i+2*n)))/s,a="scale("+o+")";e.style["-webkit-transform"]=a,e.style["-ms-transform"]=a,e.style.transform=a},setupStyles:function(){for(var e=document.createElement("style"),t="",n=208,s=160,i=640,o=640,a=2*Math.PI/this.numOfPetals,l=2*-a,r=0;r<this.numOfPetals;r++){var d=Math.round(i/2+n*Math.cos(l)-s/2),u=Math.round(o/2+n*Math.sin(l)-s/2),c=180*l/Math.PI+135;t+=["#daisywheel-js .petal:nth-of-type("+(r+1)+") {","top: "+u+"px;","left: "+d+"px;","transform: rotate("+c+"deg);","-ms-transform: rotate("+c+"deg);","-webkit-transform: rotate("+c+"deg);","} "].join(""),t+=["#daisywheel-js .petal:nth-of-type("+(r+1)+") .buttons {","transform: rotate("+-c+"deg);","-ms-transform: rotate("+-c+"deg);","-webkit-transform: rotate("+-c+"deg);","} "].join(""),l+=a}e.innerHTML=t,document.head.appendChild(e)},setupFontStyles:function(){var e="https://fonts.googleapis.com/css?family=Montserrat",t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.head.appendChild(t)},attachSymbols:function(){this.buttons=[].slice.call(document.getElementsByClassName("button"));for(var e=0;e<this.buttons.length;e++){var t=this.buttons[e],n=this.symbolSets[this.symbolSetNumber][e],s=1;n?s=1:(n="",s=.5),n.font&&(t.style.fontFamily=n.font,n=n.symbol),t.textContent=n,t.style.opacity=s}},onFocusEvent:function(e){var t=e.target;t.classList&&t.classList.contains("daisywheel")&&(e.preventDefault(),this.inputEl=t,this.load(this.onSymbolSelectionDefault))},showUI:function(){var e=document.getElementById("daisywheel"),t=document.getElementById("daisywheel-controller-warning");t.style.opacity=0,e.style.opacity=1},hideUI:function(){var e=document.getElementById("daisywheel"),t=document.getElementById("daisywheel-controller-warning");t.style.opacity=1,e.style.opacity=0},load:function(n){if(this.onSymbolSelection=n,!this.loaded){var s=document.getElementById("daisywheel-js"),i=document.getElementById("daisywheel-input");if(this.inputEl&&window.gamepadSupportAvailable){var o=this.inputEl.value;i.value=o,t.setCursor(i,o.length),this.inputEl.readOnly=!0}s.addEventListener("click",e.bind(this.unload,this)),s.style.visibility="visible",s.style.opacity=1,i.focus(),this.loaded=!0}},unload:function(t){if(this.loaded){var n=document.getElementById("daisywheel-js"),s=document.getElementById("daisywheel-input");if(t&&"daisywheel-input"===t.target.id)return;this.inputEl&&(this.inputEl.value=s.value,this.inputEl.readOnly=!1),n.removeEventListener("click",e.bind(this.unload,this)),n.style.opacity=0,n.style.visibility="hidden",this.loaded=!1}},symbols:function(e){for(var t=2,n=3,s=0;s<e.length;s++){var i=e[s],o=i.set,a=i.override;if(a&&t>-1){if(this.symbolSets.unshift(o),this.symbolSets[t]=null,i.title)switch(t){case 2:this.uiLabels["left-trigger"]=i.title;break;case 3:this.uiLabels["right-trigger"]=i.title}else console.error("Custom sets with `override` must also have the `title` property defined.");t-=1}else this.symbolSets[n]=o,n++}n>3&&(this.uiLabels["left-trigger"]="Reset",this.uiLabels["right-trigger"]="Cycle"),this.attachSymbols(),this.setupControlsUI()},onGamepadEvent:function(t){var n=t.detail;e.isEmpty(n)?(this.gamepadConnected=!1,this.hideUI()):e.map(n,e.bind(this.updateWheel,this))},updateWheel:function(e){this.gamepadConnected||(this.gamepadConnected=!0,this.showUI()),this.setDirection(e.axes),this.onButtonPress(e.buttons)},setDirection:function(e){var t=this.getPetalNum(e[0],e[1],1/this.numOfPetals*360/100);if(t){t-=1;for(var n=0;n<this.numOfPetals;n++)this.petals[n].className="petal";this.petals[t].className+=" selected",this.currentPetalNum=t}},onButtonPress:e.throttle(function(e){var t=e[this.lastButtonDownId];t&&!t.pressed&&(this.lastButtonIsUp=!0,this.onButtonUp());for(var n=0;n<e.length;n++){var s=e[n];if(s.pressed){if(this.lastButtonDownId===n&&!this.lastButtonIsUp)return;switch(console.log(n),n){case 0:case 1:case 2:case 3:this.getSymbol(n);break;case 4:this.onBackspace();break;case 5:this.onSpace();break;case 6:this.symbolSets.length<4?this.toggleSymbols(2):this.resetSymbols();break;case 7:this.symbolSets.length<4?this.toggleSymbols(1):this.cycleSymbols();break;case 12:case 13:case 14:case 15:this.onDPadPress(n)}this.lastButtonDownId=n}}},50),onButtonUp:function(){e.map(this.buttons,function(e){e.classList.remove("pressed")})},getSymbol:function(e){console.log(e);var t=4*this.currentPetalNum,n=this.buttons.slice(t,t+4),s=this.buttonMapping[e],i=n[s];i.classList.add("pressed"),this.onSymbolSelection(i.textContent),this.lastButtonIsUp=!1},onSymbolSelectionDefault:function(e){var n=document.getElementById("daisywheel-input"),s=t.getCursor(n),i=n.value,o=i.substring(0,s),a=i.substring(s,i.length);n.value=o+e+a,n.scrollLeft=n.scrollWidth},onBackspace:function(){var e=document.getElementById("daisywheel-input"),t=e.value;e.value=t.substring(0,t.length-1)},onSpace:function(){var e=document.getElementById("daisywheel-input");e.value+=" "},toggleSymbols:e.throttle(function(e){this.symbolSetNumber=this.symbolSetNumber===e?0:e,this.lastButtonIsUp=!1,this.attachSymbols()},50),cycleSymbols:function(){this.symbolSetNumber>this.symbolSets.length-1?this.symbolSetNumber++:this.symbolSetNumber=0,this.attachSymbols()},resetSymbols:function(){this.symbolSetNumber=0,this.attachSymbols()},onDPadPress:function(e){var n={12:"up",13:"down",14:"left",15:"right"},s=document.getElementById("daisywheel-input"),i=t.getCursor(s);switch(n[e]){case"up":t.setCursor(s,0);break;case"down":t.setCursor(s,s.value.length);break;case"left":t.setCursor(s,i-1);break;case"right":t.setCursor(s,i+1)}},getPetalNum:function(e,t,n){function s(e,t,n){return e>=t-n&&t+n>=e}var i=0,o=s(t,0,.1)&&s(e,0,.1),a=0===e&&0===t;return o||a?0:(e>n?i=s(t,0,n)?3:n>t?2:4:s(e,0,n)?n>t?i=1:t>n&&(i=5):i=s(t,0,n)?7:n>t?8:6,i)}},s={load:e.bind(n.load,n),unload:e.bind(n.unload,n),symbols:e.bind(n.symbols,n)};return n.init(),s});
